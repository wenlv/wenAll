<?php	/**	 * 上传类   	*/	class Upload{				protected $file = array();  //上传的文件信息		protected $path = "";     //上传路径		protected $allowType = array("image/jpeg","image/gif","image/png"); //允许的类型		protected $allowSize = 0; //允许的大小 		protected $errorInfo = ""; //错误信息		protected $newName = "";  //生成的新文件名						/**		 * 构造方法		 * @param $name  string  表单中上传文件的name		 * @param $path   string  上传目录路径 默认值 “./uploads”		*/		public function __construct($name,$path="./uploads"){			$this->file = $_FILES[$name];			$this->path = rtrim($path,"/").'/';		}				/**		 * 执行上传的方法		*/		public function saveFile(){			if($this->checkError() && $this->checkSize() && $this->checkType() && $this->loadName() && $this->moveFile()){				return $this->newName;			}else{				return false;			}		}				/**		 * 输出 错误信息		*/		public function getError(){			return $this->errorInfo;		}				/**			* 设置 允许类型		*/		public function setAllowType($allowType){			$this->allowType = $allowType;		}				/**		 * 设置允许大小		*/		public function setAllowSize($allowSize){			$this->allowSize = $allowSize;		}								/**		 * 验证错误信息		*/		private function checkError(){			//如果错误号 大于0 表示有错误			if($this->file['error'] > 0){				switch($this->file['error']){					case 1: $info = "大小超过了配置文件中大小";break;					case 2: $info = "大小超过了表单限制的大小";break;					case 3: $info = "文件只有部分上传";break;					case 4: $info = "文件没有上传";break;					case 6: $info = "找不到临时文件夹";break;					case 7: $info = "文件写入失败";break;				}				//赋值给错误信息属性				$this->errorInfo = $info;				return false;						}else{				return true;			}				}						/**		 * 验证 大小 如果 allowsize是0或小于0 不验证		*/		private function checkSize(){			if($this->allowSize > 0){				if($this->file['size'] > $this->allowSize){					$this->errorInfo = "文件过大!";					return false;				}			}			return true;					}				/**		 * 验证文件类型 如果 allowtype是空数组 不验证		*/		private function checkType(){			if(!empty($this->allowType)){				if(!in_array($this->file['type'],$this->allowType)){					$this->errorInfo = "文件类型错误";					return false;				}			}			return true;		}				/**		 * 生成新文件名		*/		private function loadName(){			$this->newName = uniqid(rand(1000,9999)).".".pathinfo($this->file['name'],PATHINFO_EXTENSION);			return true;		}				/**		 * 移动到指定目录		*/		private function moveFile(){			//判断是否是合法的上传文件			if(is_uploaded_file($this->file['tmp_name'])){				//执行移动				if(move_uploaded_file($this->file['tmp_name'],$this->path.$this->newName)){					return true;				}else{					$this->errorInfo = "文件移动失败";					return false;				}							}else{				$this->errorInfo = "不是合法的上传文件";				return false;			}		}			}?>